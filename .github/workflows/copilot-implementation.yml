name: Copilot Implementation
on:
  issues:
    types: [assigned]

jobs:
  copilot-work:
    if: github.event.assignee.login == 'copilot'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Extract Issue Number
        id: issue
        run: |
          ISSUE_NUMBER=${{ github.event.issue.number }}
          echo "issue_number=${ISSUE_NUMBER}" >> $GITHUB_OUTPUT
          echo "ISSUE_ID=${ISSUE_NUMBER}" >> $GITHUB_ENV
      
      - name: Create Context File
        run: |
          cat > /tmp/copilot-context.txt << EOF
          ISSUE_NUMBER=${{ steps.issue.outputs.issue_number }}
          ISSUE_TITLE=${{ github.event.issue.title }}
          ISSUE_BODY=${{ github.event.issue.body }}
          EOF
          cat /tmp/copilot-context.txt
      
      - name: Execute Copilot Task
        run: |
          export COPILOT_ISSUE_ID="${{ steps.issue.outputs.issue_number }}"
          echo "Working on issue #${COPILOT_ISSUE_ID}"
